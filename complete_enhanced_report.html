<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Enhanced NWB Evaluation Report - All Features</title>
    <style>
        /* ===== GLOBAL STYLES ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6; color: #333; background: #f5f5f5; padding: 20px;
        }

        .container {
            max-width: 1400px; margin: 0 auto; background: white;
            padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* ===== HEADER ===== */
        .header { border-bottom: 3px solid #2563eb; padding-bottom: 20px; margin-bottom: 30px; }
        .header h1 { color: #1e293b; font-size: 2em; margin-bottom: 10px; }
        .header .status {
            display: inline-block; padding: 8px 16px; border-radius: 6px;
            font-weight: 600; font-size: 0.95em;
        }
        .status.passed-with-issues { background: #fef3c7; color: #92400e; border: 2px solid #fbbf24; }

        h2 {
            color: #1e293b; font-size: 1.6em; margin: 30px 0 15px;
            padding: 12px 0 12px 15px; border-left: 5px solid #3b82f6;
        }
        h3 { color: #475569; font-size: 1.3em; margin: 20px 0 10px; }
        h4 { color: #64748b; font-size: 1.1em; margin: 15px 0 8px; }

        /* ===== QUICK ACTIONS TOOLBAR ===== */
        .quick-actions-toolbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px;
            position: sticky; top: 20px; z-index: 100;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .quick-actions-toolbar h4 { margin-bottom: 15px; font-size: 1.1em; color: white; }
        .quick-action-buttons { display: flex; gap: 12px; flex-wrap: wrap; }
        .quick-action {
            padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer;
            font-weight: 600; display: flex; align-items: center; gap: 8px;
            background: white; color: #333; transition: transform 0.2s, box-shadow 0.2s;
        }
        .quick-action:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .quick-action.critical { border-left: 4px solid #dc2626; }
        .quick-action.high { border-left: 4px solid #f59e0b; }
        .quick-action .time { font-size: 0.85em; color: #64748b; margin-left: auto; }
        .completion-estimate {
            margin-top: 15px; padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3); font-size: 0.95em;
        }

        /* ===== MISSING FIELDS ALERT ===== */
        .missing-fields-alert {
            background: #fef2f2; border: 2px solid #fca5a5; border-left: 6px solid #dc2626;
            border-radius: 8px; padding: 20px; margin-bottom: 30px;
        }
        .missing-fields-alert h4 { color: #991b1b; margin-bottom: 10px; font-size: 1.2em; }
        .missing-fields-list { margin: 15px 0; }
        .missing-field {
            display: flex; align-items: center; padding: 12px; margin: 8px 0;
            background: white; border-radius: 6px; border-left: 4px solid #dc2626;
        }
        .missing-field .field-name { flex: 1; font-weight: 600; }
        .missing-field .impact { margin: 0 12px; font-size: 0.9em; }
        .missing-field button {
            padding: 6px 12px; background: #2563eb; color: white; border: none;
            border-radius: 4px; cursor: pointer; font-size: 0.9em;
        }
        .missing-field button:hover { background: #1d4ed8; }
        .missing-fields-summary {
            margin-top: 15px; padding: 12px; background: #fee2e2;
            border-radius: 4px; font-size: 0.95em;
        }

        /* ===== QUALITY DASHBOARD ===== */
        .quality-dashboard {
            background: #f8fafc; padding: 30px; border-radius: 8px;
            margin-bottom: 30px; border: 1px solid #e2e8f0;
        }
        .quality-metrics-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; margin-bottom: 25px;
        }
        .quality-metric {
            background: white; padding: 20px; border-radius: 8px; text-align: center;
            border: 1px solid #e2e8f0; transition: transform 0.2s, box-shadow 0.2s;
        }
        .quality-metric:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .metric-header { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .metric-icon { font-size: 1.5em; }
        .metric-header h4 { font-size: 1em; color: #475569; margin: 0; }
        .score-circle { width: 120px; height: 120px; margin: 15px auto; position: relative; }
        .score-circle svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .score-circle circle.bg { fill: none; stroke: #e2e8f0; stroke-width: 8; }
        .score-circle circle.fill { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
        .metric-score.excellent circle.fill { stroke: #10b981; }
        .metric-score.good circle.fill { stroke: #3b82f6; }
        .metric-score.fair circle.fill { stroke: #f59e0b; }
        .metric-score.needs-work circle.fill { stroke: #ef4444; }
        .score-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 1.8em; font-weight: 700; color: #1e293b;
        }
        .metric-label { font-weight: 700; font-size: 1.1em; margin: 10px 0 5px; }
        .metric-score.excellent .metric-label { color: #10b981; }
        .metric-score.good .metric-label { color: #3b82f6; }
        .metric-score.fair .metric-label { color: #f59e0b; }
        .metric-score.needs-work .metric-label { color: #ef4444; }
        .metric-description { color: #64748b; font-size: 0.9em; }

        /* ===== METADATA COMPLETENESS ===== */
        .metadata-completeness-section {
            background: #f8fafc; padding: 25px; border-radius: 8px;
            margin-bottom: 30px; border: 1px solid #e2e8f0;
        }
        .progress-bar-container {
            width: 100%; height: 40px; background: #e2e8f0; border-radius: 20px;
            overflow: hidden; position: relative; margin-bottom: 15px;
        }
        .progress-bar {
            height: 100%; background: linear-gradient(90deg, #3b82f6, #2563eb);
            display: flex; align-items: center; justify-content: center;
            transition: width 1s ease; position: relative;
        }
        .progress-label {
            color: white; font-weight: 600; font-size: 0.95em; position: relative; z-index: 1;
        }
        .completeness-details { display: flex; gap: 20px; margin-bottom: 20px; }
        .completeness-details .stat {
            padding: 8px 16px; background: white; border-radius: 6px; border: 1px solid #cbd5e1;
        }
        .completeness-details .stat.critical { border-color: #dc2626; background: #fee2e2; }

        /* ===== METADATA WITH RICH PROVENANCE ===== */
        .metadata-section { margin-bottom: 30px; }
        .metadata-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px;
        }
        .metadata-field {
            background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #e2e8f0;
        }
        .field-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .field-label {
            font-weight: 700; color: #475569; font-size: 0.85em;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .field-value { font-size: 1.2em; color: #1e293b; font-weight: 600; margin-bottom: 12px; }
        .field-value.missing { color: #dc2626; font-style: italic; font-weight: 500; }

        /* PROVENANCE BOXES */
        .provenance-box {
            padding: 15px; border-radius: 6px; border-left: 4px solid; font-size: 0.9em; line-height: 1.6;
        }
        .provenance-box.ai-parsed { background: #dbeafe; border-left-color: #3b82f6; }
        .provenance-box.ai-inferred { background: #fed7aa; border-left-color: #f59e0b; }
        .provenance-box.file-extracted { background: #d1fae5; border-left-color: #10b981; }
        .provenance-box.system-default { background: #f1f5f9; border-left-color: #94a3b8; }
        .provenance-header {
            font-weight: 700; font-size: 0.85em; text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 8px;
        }
        .provenance-box.ai-parsed .provenance-header { color: #1e40af; }
        .provenance-box.ai-inferred .provenance-header { color: #92400e; }
        .provenance-box.file-extracted .provenance-header { color: #065f46; }
        .provenance-box.system-default .provenance-header { color: #475569; }
        .provenance-details { margin-top: 8px; }
        .provenance-details div { margin: 5px 0; }
        .confidence-display {
            display: inline-block; padding: 4px 10px; border-radius: 12px;
            font-weight: 700; font-size: 0.9em;
        }
        .confidence-display.high { background: #dcfce7; color: #166534; }
        .confidence-display.medium { background: #fef3c7; color: #92400e; }
        .origin-text {
            font-style: italic; color: #64748b; margin-top: 8px;
            padding: 8px; background: rgba(255,255,255,0.5); border-radius: 4px;
        }

        /* ===== COLLAPSIBLE SECTIONS ===== */
        .collapsible-section { margin-bottom: 20px; }
        .collapsible-header {
            background: #f1f5f9; padding: 15px 20px; border-radius: 6px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center; transition: background 0.2s;
        }
        .collapsible-header:hover { background: #e2e8f0; }
        .collapsible-header h3 { margin: 0; font-size: 1.2em; color: #1e293b; }
        .collapsible-toggle {
            font-size: 1.5em; color: #64748b; transition: transform 0.3s;
        }
        .collapsible-section.open .collapsible-toggle { transform: rotate(180deg); }
        .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .collapsible-section.open .collapsible-content { max-height: 20000px; padding: 20px; }

        /* ===== WORKFLOW TRACE STYLES ===== */
        .trace-section {
            background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px;
            padding: 25px; margin-bottom: 25px;
        }
        .trace-box {
            background: white; border: 1px solid #e2e8f0; border-radius: 6px;
            padding: 20px; margin: 15px 0; font-family: 'Courier New', monospace; font-size: 0.9em;
        }
        .trace-box.highlight { border-left: 4px solid #3b82f6; }
        .trace-item {
            padding: 12px; margin: 10px 0; background: #f1f5f9;
            border-radius: 4px; border-left: 3px solid #94a3b8;
        }
        .trace-item.success { border-left-color: #10b981; background: #ecfdf5; }
        .trace-item.info { border-left-color: #3b82f6; background: #eff6ff; }
        .checksum {
            font-family: 'Courier New', monospace; background: #1e293b; color: #10b981;
            padding: 4px 8px; border-radius: 4px; font-size: 0.85em;
        }
        .timestamp { color: #64748b; font-size: 0.9em; font-weight: 600; }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin: 15px 0;
        }
        .stat-card {
            background: white; padding: 15px; border-radius: 6px; border: 1px solid #e2e8f0;
        }
        .stat-label {
            color: #64748b; font-size: 0.85em; text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 5px;
        }
        .stat-value { color: #1e293b; font-size: 1.3em; font-weight: 700; }
        .code-block {
            background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 6px;
            overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.85em;
            line-height: 1.5; margin: 10px 0;
        }
        .code-block .comment { color: #94a3b8; }
        .code-block .key { color: #60a5fa; }
        .code-block .value { color: #10b981; }
        .provenance-chain { margin: 15px 0; padding-left: 25px; border-left: 3px solid #3b82f6; }
        .provenance-step {
            margin: 12px 0; padding: 10px; background: white; border-radius: 4px;
        }
        .badge {
            display: inline-block; padding: 4px 10px; border-radius: 12px;
            font-size: 0.85em; font-weight: 600; margin-right: 8px;
        }
        .badge.success { background: #d1fae5; color: #065f46; }
        .badge.info { background: #dbeafe; color: #1e40af; }
        .badge.warning { background: #fef3c7; color: #92400e; }
        table {
            width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em;
        }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f1f5f9; font-weight: 600; color: #475569; }
        tr:hover { background: #f8fafc; }
        .expandable { cursor: pointer; user-select: none; }
        .expandable-content {
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
        }
        .expandable-content.open { max-height: 2000px; }
        .expand-icon {
            display: inline-block; transition: transform 0.3s; margin-right: 8px;
        }
        .expandable.open .expand-icon { transform: rotate(90deg); }
        ul { margin: 10px 0 10px 25px; }
        li { margin: 5px 0; }

        /* ===== HELP & GLOSSARY ===== */
        .glossary-section {
            background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;
            padding: 25px; margin-bottom: 30px;
        }
        .glossary-term {
            background: white; border-left: 4px solid #3b82f6; padding: 15px;
            margin: 10px 0; border-radius: 4px;
        }
        .glossary-term-name {
            font-weight: 700; color: #1e293b; font-size: 1.1em; margin-bottom: 8px;
        }
        .glossary-term-definition { color: #475569; line-height: 1.6; }
        .glossary-term-link {
            color: #2563eb; text-decoration: none; font-size: 0.9em; margin-top: 5px; display: inline-block;
        }

        /* ===== CONFIDENCE GUIDE ===== */
        .confidence-guide {
            background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;
            padding: 25px; margin-bottom: 30px;
        }
        .confidence-level {
            background: white; border-left: 4px solid; padding: 15px;
            margin: 15px 0; border-radius: 4px;
        }
        .confidence-level.high { border-left-color: #10b981; }
        .confidence-level.medium { border-left-color: #f59e0b; }
        .confidence-level.low { border-left-color: #dc2626; }
        .confidence-level-header {
            font-weight: 700; font-size: 1.1em; margin-bottom: 10px;
        }
        .confidence-level.high .confidence-level-header { color: #065f46; }
        .confidence-level.medium .confidence-level-header { color: #92400e; }
        .confidence-level.low .confidence-level-header { color: #991b1b; }
        .confidence-level ul { margin-top: 10px; }

        /* ===== FOOTER ===== */
        .footer {
            margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0;
            text-align: center; color: #64748b; font-size: 0.9em;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .metadata-grid { grid-template-columns: 1fr; }
            .quality-metrics-grid { grid-template-columns: 1fr; }
            .quick-action-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üî¨ Complete Enhanced NWB Evaluation Report</h1>
            <div class="status passed-with-issues">‚ö†Ô∏è PASSED WITH ISSUES</div>
            <p style="margin-top: 10px; color: #64748b;">
                Generated: November 4, 2025 at 4:25 PM | Session: session_20251104_162200
            </p>
        </div>

        <!-- QUICK ACTIONS TOOLBAR -->
        <div class="quick-actions-toolbar">
            <h4>‚ö° Quick Actions</h4>
            <div class="quick-action-buttons">
                <button class="quick-action critical" onclick="alert('Fix DANDI blockers wizard')">
                    <span class="icon">üî¥</span> Fix DANDI Blockers (2) <span class="time">5 min</span>
                </button>
                <button class="quick-action high" onclick="alert('Fix name format')">
                    <span class="icon">‚úèÔ∏è</span> Fix Name Format <span class="time">30 sec</span>
                </button>
                <button class="quick-action" onclick="alert('Add descriptions')">
                    <span class="icon">üìù</span> Add Descriptions <span class="time">3 min</span>
                </button>
                <button class="quick-action" onclick="alert('Re-validate')">
                    <span class="icon">üîÑ</span> Re-validate After Fixes
                </button>
            </div>
            <div class="completion-estimate">
                <strong>Total time to fix all issues:</strong> ~10 minutes
            </div>
        </div>

        <!-- MISSING FIELDS ALERT -->
        <div class="missing-fields-alert">
            <h4>‚ö†Ô∏è Missing Required Metadata (2 critical)</h4>
            <p>The following fields are required for DANDI submission but are currently missing:</p>
            <div class="missing-fields-list">
                <div class="missing-field critical">
                    <span class="field-name">Species</span>
                    <span class="impact">üî¥ DANDI blocker</span>
                    <button onclick="alert('Add species guide')">How to fix</button>
                </div>
                <div class="missing-field critical">
                    <span class="field-name">Subject Age or Date of Birth</span>
                    <span class="impact">üî¥ DANDI blocker</span>
                    <button onclick="alert('Add age guide')">How to fix</button>
                </div>
            </div>
            <div class="missing-fields-summary">
                <strong>Impact:</strong> 2 critical fields must be added before DANDI submission.<br>
                <strong>Estimated time to fix:</strong> 5-10 minutes
            </div>
        </div>

        <!-- QUALITY DASHBOARD -->
        <div class="quality-dashboard">
            <h3>üéØ Quality Assessment Dashboard</h3>
            <div class="quality-metrics-grid">
                <div class="quality-metric">
                    <div class="metric-header"><span class="metric-icon">üìä</span><h4>Completeness</h4></div>
                    <div class="metric-score fair">
                        <div class="score-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45"></circle>
                                <circle class="fill" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="155"></circle>
                            </svg>
                            <span class="score-text">45%</span>
                        </div>
                    </div>
                    <p class="metric-label">Fair</p>
                    <p class="metric-description">9 of 20 fields filled</p>
                </div>
                <div class="quality-metric">
                    <div class="metric-header"><span class="metric-icon">üîí</span><h4>Data Integrity</h4></div>
                    <div class="metric-score excellent">
                        <div class="score-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45"></circle>
                                <circle class="fill" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="0"></circle>
                            </svg>
                            <span class="score-text">100%</span>
                        </div>
                    </div>
                    <p class="metric-label">Excellent</p>
                    <p class="metric-description">No validation errors</p>
                </div>
                <div class="quality-metric">
                    <div class="metric-header"><span class="metric-icon">üî¨</span><h4>Scientific Value</h4></div>
                    <div class="metric-score good">
                        <div class="score-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45"></circle>
                                <circle class="fill" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="85"></circle>
                            </svg>
                            <span class="score-text">70%</span>
                        </div>
                    </div>
                    <p class="metric-label">Good</p>
                    <p class="metric-description">Limited by incomplete metadata</p>
                </div>
                <div class="quality-metric">
                    <div class="metric-header"><span class="metric-icon">üóÑÔ∏è</span><h4>DANDI Ready</h4></div>
                    <div class="metric-score needs-work">
                        <div class="score-circle">
                            <svg viewBox="0 0 100 100">
                                <circle class="bg" cx="50" cy="50" r="45"></circle>
                                <circle class="fill" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="113"></circle>
                            </svg>
                            <span class="score-text">60%</span>
                        </div>
                    </div>
                    <p class="metric-label">Needs Improvement</p>
                    <p class="metric-description">2 required fields missing</p>
                </div>
            </div>
        </div>

        <!-- METADATA COMPLETENESS -->
        <div class="metadata-completeness-section">
            <h3>üìä Metadata Completeness</h3>
            <div class="completeness-visual">
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 45%">
                        <span class="progress-label">45% Complete</span>
                    </div>
                </div>
                <div class="completeness-details">
                    <span class="stat"><strong>9 of 20</strong> recommended fields filled</span>
                    <span class="stat critical"><strong>3 of 5</strong> required fields filled</span>
                </div>
            </div>
        </div>

        <!-- FILE INFORMATION -->
        <h2>üìÅ File Information</h2>
        <div class="trace-box">
            <strong>Input Files:</strong>
            <ul>
                <li>Noise4Sam_g0_t0.imec0.ap.bin (610 KB)</li>
                <li>Noise4Sam_g0_t0.imec0.ap.meta (2.3 KB)</li>
            </ul>
            <strong>Output File:</strong> converted_nwb_uploads.nwb (628 KB)<br>
            <strong>Format:</strong> SpikeGLX ‚Üí NWB 2.6.0<br>
            <strong>Conversion Time:</strong> 3 minutes 27 seconds
        </div>

        <!-- METADATA WITH RICH PROVENANCE -->
        <div class="metadata-section">
            <h2>üìã Metadata Details with Provenance</h2>
            <div class="metadata-grid">
                <!-- EXPERIMENTER -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">EXPERIMENTER</span></div>
                    <div class="field-value">Smith, Jane</div>
                    <div class="provenance-box ai-parsed">
                        <div class="provenance-header">AI METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> ai-parsed</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">95.0%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> AI parsed from: 'Dr. Jane Smith'
                            </div>
                        </div>
                    </div>
                </div>

                <!-- INSTITUTION -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">INSTITUTION</span></div>
                    <div class="field-value">Massachusetts Institute of Technology</div>
                    <div class="provenance-box ai-parsed">
                        <div class="provenance-header">AI METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> ai-parsed</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">90.0%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> AI parsed from: 'MIT'
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EXPERIMENT DESCRIPTION -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">EXPERIMENT DESCRIPTION</span></div>
                    <div class="field-value">Recording neural activity from visual cortex using electrophysiology</div>
                    <div class="provenance-box ai-inferred">
                        <div class="provenance-header">INFERRED METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> ai-inferred</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">80.0%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> AI inferred from: 'recording neural activity from the visual cortex'
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SUBJECT ID -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">SUBJECT ID</span></div>
                    <div class="field-value">mouse001</div>
                    <div class="provenance-box ai-parsed">
                        <div class="provenance-header">AI METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> ai-parsed</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">95.0%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> AI parsed from: 'mouse001'
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEX -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">SEX</span></div>
                    <div class="field-value">M</div>
                    <div class="provenance-box ai-parsed">
                        <div class="provenance-header">AI METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> ai-parsed</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">95.0%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> AI parsed from: 'male'
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SAMPLE RATE -->
                <div class="metadata-field">
                    <div class="field-header"><span class="field-label">SAMPLE RATE</span></div>
                    <div class="field-value">30000 Hz</div>
                    <div class="provenance-box file-extracted">
                        <div class="provenance-header">FILE-EXTRACTED METADATA</div>
                        <div class="provenance-details">
                            <div><strong>Source:</strong> file-extracted</div>
                            <div><strong>Confidence:</strong> <span class="confidence-display high">100%</span></div>
                            <div class="origin-text">
                                <strong>Origin:</strong> Extracted from: 'Noise4Sam_g0_t0.imec0.ap.meta'
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HELP & GLOSSARY (COLLAPSIBLE) -->
        <div class="collapsible-section" id="glossary-section">
            <div class="collapsible-header" onclick="toggleSection('glossary-section')">
                <h3>üìö Help & Glossary</h3>
                <span class="collapsible-toggle">‚ñº</span>
            </div>
            <div class="collapsible-content">
                <div class="glossary-section">
                    <div class="glossary-term">
                        <div class="glossary-term-name">NWB (Neurodata Without Borders)</div>
                        <div class="glossary-term-definition">
                            A standardized data format for neurophysiology, developed by the neuroscience community to enable data sharing, reproducibility, and collaboration.
                        </div>
                        <a href="https://www.nwb.org/" class="glossary-term-link" target="_blank">Learn more ‚Üí</a>
                    </div>

                    <div class="glossary-term">
                        <div class="glossary-term-name">DANDI Archive</div>
                        <div class="glossary-term-definition">
                            A platform for publishing, sharing, and processing neurophysiology data. NWB files must meet specific quality standards to be accepted.
                        </div>
                        <a href="https://dandiarchive.org/" class="glossary-term-link" target="_blank">Learn more ‚Üí</a>
                    </div>

                    <div class="glossary-term">
                        <div class="glossary-term-name">Provenance Types</div>
                        <div class="glossary-term-definition">
                            <ul>
                                <li><strong>üë§ User-Specified:</strong> You directly provided this value</li>
                                <li><strong>üß† AI-Parsed:</strong> AI extracted from your explicit statement (high confidence)</li>
                                <li><strong>ü§ñ AI-Inferred:</strong> AI deduced from context (requires verification)</li>
                                <li><strong>üìÑ File-Extracted:</strong> Read from your data file</li>
                                <li><strong>üìã Schema-Default:</strong> Standard NWB default value</li>
                                <li><strong>‚ö™ System-Default:</strong> Fallback value</li>
                            </ul>
                        </div>
                    </div>

                    <div class="glossary-term">
                        <div class="glossary-term-name">Confidence Scores</div>
                        <div class="glossary-term-definition">
                            Indicates how certain the AI is about extracted/inferred values (0-100%). Higher scores = more reliable, lower scores = should verify manually.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONFIDENCE SCORE GUIDE (COLLAPSIBLE) -->
        <div class="collapsible-section" id="confidence-section">
            <div class="collapsible-header" onclick="toggleSection('confidence-section')">
                <h3>üìä Confidence Score Guide</h3>
                <span class="collapsible-toggle">‚ñº</span>
            </div>
            <div class="collapsible-content">
                <div class="confidence-guide">
                    <div class="confidence-level high">
                        <div class="confidence-level-header">‚úÖ HIGH (80-100%)</div>
                        <ul>
                            <li><strong>What it means:</strong> AI is highly confident</li>
                            <li><strong>Action needed:</strong> Minimal - quick review recommended</li>
                            <li><strong>DANDI ready:</strong> Yes, safe to submit</li>
                            <li><strong>Example:</strong> "MIT" ‚Üí "Massachusetts Institute of Technology"</li>
                        </ul>
                    </div>

                    <div class="confidence-level medium">
                        <div class="confidence-level-header">‚ö†Ô∏è MEDIUM (50-79%)</div>
                        <ul>
                            <li><strong>What it means:</strong> AI made best guess, some uncertainty</li>
                            <li><strong>Action needed:</strong> Verify value before DANDI submission</li>
                            <li><strong>DANDI ready:</strong> Should review first</li>
                            <li><strong>Example:</strong> "studying V1" ‚Üí "Visual cortex study"</li>
                        </ul>
                    </div>

                    <div class="confidence-level low">
                        <div class="confidence-level-header">‚ùå LOW (0-49%)</div>
                        <ul>
                            <li><strong>What it means:</strong> AI is uncertain, value may be incorrect</li>
                            <li><strong>Action needed:</strong> MUST verify and correct if needed</li>
                            <li><strong>DANDI ready:</strong> No, correction required</li>
                            <li><strong>Example:</strong> Vague context ‚Üí Guessed value</li>
                        </ul>
                    </div>

                    <h4 style="margin-top: 20px;">When to Manually Verify:</h4>
                    <div class="trace-box">
                        <strong>Always verify if:</strong>
                        <ul>
                            <li>‚úì Confidence score is below 80%</li>
                            <li>‚úì Field is marked "AI-Inferred" (ü§ñ)</li>
                            <li>‚úì Field shows "needs review" flag</li>
                            <li>‚úì You're submitting to DANDI Archive</li>
                            <li>‚úì The data will be used in publications</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROVENANCE EXPLAINER (COLLAPSIBLE) -->
        <div class="collapsible-section" id="provenance-section">
            <div class="collapsible-header" onclick="toggleSection('provenance-section')">
                <h3>üîç Understanding Metadata Provenance</h3>
                <span class="collapsible-toggle">‚ñº</span>
            </div>
            <div class="collapsible-content">
                <div class="trace-section">
                    <p style="color: #64748b; margin-bottom: 20px;">
                        Provenance tracking shows you exactly where each piece of metadata came from. This transparency is critical for scientific reproducibility, DANDI Archive compliance, and trusting AI-assisted conversions.
                    </p>

                    <h4>Provenance Workflow Diagram</h4>
                    <div class="trace-box">
                        <pre style="line-height: 1.8; font-family: monospace;">
INPUT SOURCES          PROCESSING              OUTPUT

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User Input   ‚îÇ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ (Chat/Form)  ‚îÇ   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚Üí AI Parser ‚îÄ‚îÄ‚Üí NWB
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ    (Claude)      File
‚îÇ Data Files   ‚îÇ‚îÄ‚îÄ‚îÄ‚î§    + Confidence
‚îÇ (.meta, etc) ‚îÇ   ‚îÇ      Score
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                   ‚îî‚îÄ‚îÄ‚Üí Rule-based ‚îÄ‚îÄ‚Üí Report
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        Extraction
‚îÇ NWB Schema   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
‚îÇ Defaults     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        </pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPLETE WORKFLOW TRACE (COLLAPSIBLE WITH ALL 9 SECTIONS) -->
        <div class="collapsible-section" id="workflow-section">
            <div class="collapsible-header" onclick="toggleSection('workflow-section')">
                <h3>üîÑ Complete Workflow Trace (9 Sections)</h3>
                <span class="collapsible-toggle">‚ñº</span>
            </div>
            <div class="collapsible-content">

                <!-- All 9 sections from the detailed workflow trace -->
                <!-- SECTION 1: SESSION INFO -->
                <div class="trace-section">
                    <h3>1. Session Information</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Session ID</div>
                            <div class="stat-value">session_20251104_162200</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Start Time</div>
                            <div class="stat-value">2025-11-04 16:22:00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">End Time</div>
                            <div class="stat-value">2025-11-04 16:25:27</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Duration</div>
                            <div class="stat-value">3m 27s</div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 2: INPUT FILES -->
                <div class="trace-section">
                    <h3>2. Input Files Tracking</h3>
                    <div class="trace-box highlight">
                        <strong>üìÑ File 1: Noise4Sam_g0_t0.imec0.ap.bin</strong>
                        <ul>
                            <li><strong>Size:</strong> 610 KB</li>
                            <li><strong>Format:</strong> SpikeGLX binary</li>
                            <li><strong>MD5:</strong> <span class="checksum">a3b5c7d9e1f2a4b6c8d0e2f4a6b8c0d2</span></li>
                            <li><strong>Channels:</strong> 384 (Neuropixels 1.0)</li>
                            <li><strong>Sample Rate:</strong> 30000 Hz</li>
                            <li><strong>Duration:</strong> 60 seconds</li>
                        </ul>
                    </div>
                </div>

                <!-- SECTION 3: USER INTERACTION LOG -->
                <div class="trace-section">
                    <h3>3. User Interaction Log</h3>
                    <div class="trace-item info">
                        <span class="timestamp">[16:22:05]</span> <strong>User uploaded files</strong>
                    </div>
                    <div class="trace-item success">
                        <span class="timestamp">[16:22:14]</span> <strong>Format detected: SpikeGLX</strong>
                    </div>
                    <div class="trace-item info">
                        <span class="timestamp">[16:22:20]</span> <strong>User provided metadata via chat</strong>
                    </div>
                    <div class="trace-item success">
                        <span class="timestamp">[16:22:24]</span> <strong>AI extracted 8 metadata fields</strong>
                    </div>
                    <div class="trace-item success">
                        <span class="timestamp">[16:25:20]</span> <strong>Conversion completed</strong>
                    </div>
                    <div class="trace-item success">
                        <span class="timestamp">[16:25:27]</span> <strong>Validation completed</strong>
                    </div>
                </div>

                <!-- SECTION 4: AI PROCESSING DETAILS -->
                <div class="trace-section">
                    <h3>4. AI Processing Log</h3>
                    <div class="trace-box">
                        <strong>AI Service:</strong> Anthropic Claude API<br>
                        <strong>Model:</strong> claude-3-5-sonnet-20241022<br>
                        <strong>Purpose:</strong> Natural language metadata extraction<br>
                        <strong>Total API calls:</strong> 1<br>
                        <strong>Processing time:</strong> 2.8 seconds<br>
                        <strong>Fields extracted:</strong> 8 (5 explicit, 3 inferred)<br>
                        <strong>Average confidence:</strong> 88.75%<br>
                        <strong>Cost:</strong> $0.0034 USD
                    </div>
                </div>

                <!-- SECTION 5: CONVERSION PIPELINE -->
                <div class="trace-section">
                    <h3>5. Conversion Pipeline</h3>
                    <div class="trace-item success">
                        <strong>STEP 1: Format Detection</strong> - 0.15s - ‚úÖ Completed
                    </div>
                    <div class="trace-item success">
                        <strong>STEP 2: Metadata Collection</strong> - 4.2s - ‚úÖ Completed (15 fields)
                    </div>
                    <div class="trace-item success">
                        <strong>STEP 3: Data Conversion</strong> - 2m 55s - ‚úÖ Completed
                    </div>
                    <div class="trace-item success">
                        <strong>STEP 4: NWB Validation</strong> - 7.1s - ‚úÖ Completed (0 errors)
                    </div>
                    <div class="trace-item success">
                        <strong>STEP 5: Report Generation</strong> - 0.3s - ‚úÖ Completed
                    </div>
                </div>

                <!-- SECTION 6: METADATA PROVENANCE TRACE -->
                <div class="trace-section">
                    <h3>6. Metadata Provenance Summary</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">AI-Parsed</div>
                            <div class="stat-value">5 (33%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">AI-Inferred</div>
                            <div class="stat-value">3 (20%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">File-Extracted</div>
                            <div class="stat-value">4 (27%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">System-Default</div>
                            <div class="stat-value">3 (20%)</div>
                        </div>
                    </div>
                </div>

                <!-- SECTION 7: OUTPUT FILES -->
                <div class="trace-section">
                    <h3>7. Output Files Summary</h3>
                    <div class="trace-box">
                        <strong>Primary Output:</strong> converted_nwb_uploads.nwb (628 KB)<br>
                        <strong>MD5:</strong> <span class="checksum">7f9d8e6c5b4a3e2d1c0b9a8e7f6d5c4b</span><br>
                        <strong>Validation:</strong> ‚úÖ PASSED<br>
                        <strong>Report Files:</strong> HTML (847 KB), JSON (12 KB), TXT (8 KB)
                    </div>
                </div>

                <!-- SECTION 8: SYSTEM ENVIRONMENT -->
                <div class="trace-section">
                    <h3>8. System Environment</h3>
                    <div class="trace-box">
                        <strong>Operating System:</strong> macOS 14.0<br>
                        <strong>Python:</strong> 3.11.4<br>
                        <strong>PyNWB:</strong> 2.6.0<br>
                        <strong>NeuroConv:</strong> 0.4.10<br>
                        <strong>NWBInspector:</strong> 0.6.5<br>
                        <strong>AI Model:</strong> claude-3-5-sonnet-20241022
                    </div>
                </div>

                <!-- SECTION 9: ERROR LOG -->
                <div class="trace-section">
                    <h3>9. Process Log</h3>
                    <div class="trace-item success" style="text-align: center; padding: 20px;">
                        <strong>‚úÖ No errors encountered during this conversion</strong>
                    </div>
                </div>

            </div>
        </div>

        <!-- VALIDATION RESULTS -->
        <h2>‚úÖ Validation Results</h2>
        <div class="trace-box">
            <strong>Overall Status:</strong> PASSED WITH ISSUES<br>
            <strong>Critical Errors:</strong> 0<br>
            <strong>Warnings:</strong> 0<br>
            <strong>Missing Recommended Fields:</strong> 2<br>
            <strong>DANDI Readiness:</strong> ‚ö†Ô∏è Needs 2 additional fields
        </div>

        <!-- RECOMMENDATIONS -->
        <h2>üìã Recommended Actions</h2>
        <div class="trace-section">
            <div class="trace-item" style="border-left-color: #dc2626;">
                <strong>üî¥ CRITICAL - Add Species Field (2 min)</strong><br>
                Add scientific name (e.g., "Mus musculus" for mouse). Required for DANDI submission.
            </div>
            <div class="trace-item" style="border-left-color: #dc2626;">
                <strong>üî¥ CRITICAL - Add Age or Date of Birth (2 min)</strong><br>
                Use ISO 8601 duration format (e.g., "P60D" for 60 days). Required for DANDI submission.
            </div>
            <div class="trace-item" style="border-left-color: #f59e0b;">
                <strong>üü° HIGH - Fix Experimenter Name Format (1 min)</strong><br>
                Change to "LastName, FirstName" format for DANDI compliance.
            </div>
            <div class="trace-item" style="border-left-color: #3b82f6;">
                <strong>üîµ MEDIUM - Add Session Description (3 min)</strong><br>
                Describe what happened in this recording session for better documentation.
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p>ü§ñ Generated with <strong>AI-Assisted NWB Conversion Tool</strong> v1.0.0</p>
            <p style="margin-top: 8px;">Using: PyNWB 2.6.0 | NeuroConv 0.4.10 | NWBInspector 0.6.5 | Anthropic Claude API</p>
            <p style="margin-top: 8px;">
                This report includes all enhancements from the HTML Report Enhancement Plan for worldwide adoption.
            </p>
        </div>
    </div>

    <script>
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('open');
        }

        function toggleExpand(element) {
            element.classList.toggle('open');
            const content = element.nextElementSibling;
            content.classList.toggle('open');
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Animate progress bars
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 100);
            });

            // Animate circular progress indicators
            const circles = document.querySelectorAll('.score-circle');
            circles.forEach(circle => {
                const scoreText = circle.querySelector('.score-text');
                if (scoreText) {
                    const score = parseInt(scoreText.textContent.replace('%', '')) || 0;
                    const circumference = 2 * Math.PI * 45;
                    const offset = circumference - (score / 100) * circumference;

                    const fillCircle = circle.querySelector('circle.fill');
                    if (fillCircle) {
                        fillCircle.style.strokeDashoffset = circumference;
                        setTimeout(() => {
                            fillCircle.style.strokeDashoffset = offset;
                        }, 500);
                    }
                }
            });

            console.log('üî¨ Complete Enhanced NWB Report Loaded - All Features Included');
            console.log('‚úÖ Quick Actions Toolbar');
            console.log('‚úÖ Missing Fields Alert');
            console.log('‚úÖ Quality Dashboard');
            console.log('‚úÖ Metadata Completeness Progress');
            console.log('‚úÖ Rich Provenance Boxes');
            console.log('‚úÖ Help & Glossary');
            console.log('‚úÖ Confidence Score Guide');
            console.log('‚úÖ Provenance Explainer');
            console.log('‚úÖ Complete 9-Section Workflow Trace');
            console.log('‚úÖ Validation Results');
            console.log('‚úÖ Priority-Ranked Recommendations');
        });
    </script>
</body>
</html>
