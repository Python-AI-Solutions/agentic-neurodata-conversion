{# Issues List Component #}
<section class="section issues-section collapsible-section open" id="issues-section">
    <div class="collapsible-header" onclick="toggleSection('issues-section')">
        <h2 class="section-title">
            <span class="icon">üêõ</span>
            Issues & Findings
            <span class="issue-count">({{ issues|length }})</span>
        </h2>
        <span class="collapsible-toggle">‚ñº</span>
    </div>

    <div class="collapsible-content">
        {# Search and Filter Controls #}
        <div class="controls">
        <div class="search-box">
            <input type="text"
                   id="issue-search"
                   placeholder="Search issues... (Ctrl+K)"
                   class="search-input">
            <span class="search-icon">üîç</span>
        </div>

        <div class="filter-group">
            <label for="severity-filter">Filter by severity:</label>
            <select id="severity-filter" class="filter-select">
                <option value="all">All Severities</option>
                <option value="critical">Critical</option>
                <option value="error">Error</option>
                <option value="warning">Warning</option>
                <option value="info">Info</option>
            </select>
        </div>
    </div>

    {# Results count (dynamically updated by JavaScript) #}
    <div id="results-count"></div>

    {# Issues List #}
    <div class="issues-list">
        {% for issue in issues %}
            <div class="issue-card" data-severity="{{ issue.severity | lower }}">
                <div class="issue-header" onclick="toggleIssue(this.parentElement)">
                    <div class="issue-header-left">
                        <span class="severity-badge severity-{{ issue.severity | lower }}">
                            {% if issue.severity == 'CRITICAL' %}ÔøΩÔøΩ
                            {% elif issue.severity == 'ERROR' %}‚ùå
                            {% elif issue.severity == 'WARNING' %}‚ö†Ô∏è
                            {% else %}‚ÑπÔ∏è
                            {% endif %}
                            {{ issue.severity }}
                        </span>
                        <h3 class="issue-title">{{ issue.title | default(issue.message[:50] + '...') }}</h3>
                    </div>
                    <div class="issue-header-right">
                        {% if issue.location %}
                            <span class="issue-location">{{ issue.location }}</span>
                        {% endif %}
                        <span class="expand-icon">‚ñº</span>
                    </div>
                </div>

                <div class="issue-details collapsed">
                    <div class="issue-message">
                        {{ issue.message }}
                    </div>

                    {% if issue.context %}
                    <div class="issue-context">
                        <h4 class="context-title">Context</h4>
                        {% if issue.context is mapping %}
                            <pre class="context-code">{{ issue.context | tojson(indent=2) }}</pre>
                        {% else %}
                            <p>{{ issue.context }}</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if issue.suggestion or issue.fix %}
                    <div class="issue-suggestion">
                        <h4 class="suggestion-title">üí° Suggested Fix</h4>
                        <p>{{ issue.suggestion | default(issue.fix) }}</p>
                    </div>
                    {% endif %}

                    {% if issue.code_snippet %}
                    <div class="code-snippet-container">
                        <h4 class="code-title">Code Reference</h4>
                        <pre class="code-snippet">{{ issue.code_snippet }}</pre>
                        <button class="copy-button" onclick="copyToClipboard(this)">
                            üìã Copy
                        </button>
                    </div>
                    {% endif %}

                    {% if issue.references %}
                    <div class="issue-references">
                        <h4 class="references-title">References</h4>
                        <ul class="references-list">
                            {% for ref in issue.references %}
                                <li>
                                    {% if ref.url %}
                                        <a href="{{ ref.url }}" target="_blank">{{ ref.title | default(ref.url) }}</a>
                                    {% else %}
                                        {{ ref.title | default(ref) }}
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="issue-metadata">
                        {% if issue.check_name %}
                            <span class="metadata-tag">Check: {{ issue.check_name }}</span>
                        {% endif %}
                        {% if issue.timestamp %}
                            <span class="metadata-tag">Detected: {{ issue.timestamp | format_timestamp }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>

        {% if issues|length == 0 %}
        <div class="empty-state">
            <div class="empty-icon">‚úÖ</div>
            <p>No issues found! Your data looks great.</p>
        </div>
        {% endif %}
    </div>
</section>
