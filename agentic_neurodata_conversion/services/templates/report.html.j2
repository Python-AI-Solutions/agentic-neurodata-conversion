<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NWB Conversion Evaluation Report - {{ report_data.session_id }}">
    <title>NWB Evaluation Report - {{ report_data.session_id }}</title>

    {# Embedded CSS - No external dependencies #}
    <style>
        {% include 'assets/styles.css.j2' %}
    </style>
</head>
<body>
    <div class="report-container">
        {# Report Header #}
        {% include 'components/header.html.j2' %}

        {# Enhanced: Quick Actions Toolbar #}
        {% include 'components/quick_actions.html.j2' %}

        {# Enhanced: Missing Fields Alert #}
        {% include 'components/missing_fields_alert.html.j2' %}

        {# Enhanced: Quality Dashboard #}
        {% include 'components/quality_dashboard.html.j2' %}

        {# File Information Section #}
        {% include 'components/file_info.html.j2' %}

        {# Validation Results Summary #}
        {% include 'components/validation_results.html.j2' %}

        {# Issues List (Searchable/Filterable) #}
        {% if issues and issues|length > 0 %}
            {% include 'components/issues_list.html.j2' %}
        {% endif %}

        {# Recommendations Section #}
        {% if recommendations and recommendations|length > 0 %}
            {% include 'components/recommendations.html.j2' %}
        {% endif %}

        {# Workflow Trace Section #}
        {% if workflow_trace and workflow_trace|length > 0 %}
            {% include 'components/workflow_trace.html.j2' %}
        {% endif %}

        {# Enhanced: Help & Glossary #}
        {% include 'components/help_glossary.html.j2' %}

        {# Report Footer #}
        <footer class="report-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>About This Report</h4>
                    <p>
                        This report was automatically generated by the NWB Conversion System.
                        It provides detailed information about the conversion process, validation results,
                        and data provenance tracking.
                    </p>
                </div>
                <div class="footer-section">
                    <h4>Report Information</h4>
                    <ul class="footer-list">
                        <li><strong>Session ID:</strong> {{ report_data.session_id }}</li>
                        <li><strong>Generated:</strong> {{ report_data.timestamp | format_timestamp }}</li>
                        <li><strong>System Version:</strong> {{ report_data.system_version | default('1.0.0') }}</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul class="footer-list">
                        <li><a href="https://www.nwb.org/" target="_blank">NWB Documentation</a></li>
                        <li><a href="https://github.com/catalystneuro/neuroconv" target="_blank">NeuroConv GitHub</a></li>
                        <li><a href="https://dandiarchive.org/" target="_blank">DANDI Archive</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; {{ report_data.timestamp | format_year }} NWB Conversion System. All rights reserved.</p>
            </div>
        </footer>
    </div>

    {# Inject comprehensive report data as JSON for JavaScript access #}
    <script>
        // Make comprehensive report data available to JavaScript
        const reportData = {
            // Report metadata
            report_metadata: {
                version: "2.0",
                session_id: {{ report_data.session_id | tojson | safe }},
                generated_at: {{ report_data.timestamp | tojson | safe }},
                system_version: {{ report_data.system_version | tojson | safe }}
            },

            // Evaluation summary
            evaluation_summary: {
                status: {{ report_data.status | tojson | safe }},
                file_name: {{ report_data.file_name | tojson | safe }},
                file_format: {{ report_data.file_format | tojson | safe }},
                summary: {{ report_data.summary | tojson | safe }}
            },

            // Complete file information with provenance tracking
            file_information: {{ file_info | tojson | safe }},

            // Validation results and issues
            validation_results: {{ validation_results | tojson | safe }},
            issues: {{ issues | tojson | safe }},
            issues_by_severity: {{ issues_by_severity | tojson | safe }},

            // Quality metrics and assessment
            quality_metrics: {{ quality_metrics | tojson | safe }},
            metadata_completeness: {{ metadata_completeness | tojson | safe }},

            // Missing fields analysis
            missing_fields: {{ missing_fields | tojson | safe }},
            missing_critical_fields: {{ missing_critical_fields | tojson | safe }},

            // Recommendations for improvement
            recommendations: {{ recommendations | tojson | safe }},
            total_estimated_time: {{ total_estimated_time | tojson | safe }},

            // Workflow trace and audit trail
            workflow_trace: {{ workflow_trace | tojson | safe }},

            // Detailed process logs for scientific transparency
            detailed_logs: {
                logs: {{ detailed_logs_sequential | tojson | safe }},
                log_file_path: {{ log_file_path | tojson | safe }},
                stage_options: {{ stage_options | tojson | safe }}
            }
        };
    </script>

    {# Embedded JavaScript - No external dependencies #}
    <script>
        {% include 'assets/scripts.js.j2' %}
    </script>
</body>
</html>
