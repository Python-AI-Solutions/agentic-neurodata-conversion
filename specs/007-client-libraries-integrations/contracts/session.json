{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Session Management Contracts",
  "description": "JSON-RPC contracts for session and conversation management",

  "create_session": {
    "request": {
      "type": "object",
      "required": ["jsonrpc", "id", "method", "params"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "method": {"type": "string", "const": "create_session"},
        "params": {
          "type": "object",
          "properties": {
            "metadata": {
              "type": "object",
              "description": "Optional session metadata",
              "additionalProperties": true
            }
          }
        }
      }
    },
    "response": {
      "type": "object",
      "required": ["jsonrpc", "id", "result"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "result": {
          "type": "object",
          "required": ["id", "created_at"],
          "properties": {
            "id": {
              "type": "string",
              "description": "Session ID"
            },
            "created_at": {
              "type": "string",
              "format": "date-time"
            },
            "metadata": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    }
  },

  "get_session_history": {
    "request": {
      "type": "object",
      "required": ["jsonrpc", "id", "method", "params"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "method": {"type": "string", "const": "get_session_history"},
        "params": {
          "type": "object",
          "required": ["session_id"],
          "properties": {
            "session_id": {
              "type": "string",
              "description": "Session ID to retrieve history for"
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "description": "Maximum number of messages to return"
            },
            "offset": {
              "type": "integer",
              "minimum": 0,
              "description": "Offset for pagination"
            }
          }
        }
      }
    },
    "response": {
      "type": "object",
      "required": ["jsonrpc", "id", "result"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "result": {
          "type": "object",
          "required": ["session_id", "messages", "total"],
          "properties": {
            "session_id": {"type": "string"},
            "messages": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "role", "content", "timestamp"],
                "properties": {
                  "id": {"type": "string"},
                  "role": {
                    "type": "string",
                    "enum": ["user", "assistant", "system"]
                  },
                  "content": {"type": "string"},
                  "timestamp": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "agent": {
                    "type": ["string", "null"],
                    "enum": [null, "orchestrator", "analysis", "conversion", "evaluation"]
                  },
                  "metadata": {
                    "type": "object",
                    "additionalProperties": true
                  }
                }
              }
            },
            "total": {
              "type": "integer",
              "description": "Total number of messages in session"
            },
            "has_more": {
              "type": "boolean",
              "description": "Whether more messages are available"
            }
          }
        }
      }
    }
  },

  "add_message": {
    "request": {
      "type": "object",
      "required": ["jsonrpc", "id", "method", "params"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "method": {"type": "string", "const": "add_message"},
        "params": {
          "type": "object",
          "required": ["session_id", "role", "content"],
          "properties": {
            "session_id": {"type": "string"},
            "role": {
              "type": "string",
              "enum": ["user", "assistant", "system"]
            },
            "content": {"type": "string"},
            "agent": {
              "type": ["string", "null"],
              "enum": [null, "orchestrator", "analysis", "conversion", "evaluation"]
            },
            "metadata": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    },
    "response": {
      "type": "object",
      "required": ["jsonrpc", "id", "result"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "result": {
          "type": "object",
          "required": ["message_id"],
          "properties": {
            "message_id": {"type": "string"},
            "timestamp": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      }
    }
  },

  "delete_session": {
    "request": {
      "type": "object",
      "required": ["jsonrpc", "id", "method", "params"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "method": {"type": "string", "const": "delete_session"},
        "params": {
          "type": "object",
          "required": ["session_id"],
          "properties": {
            "session_id": {"type": "string"}
          }
        }
      }
    },
    "response": {
      "type": "object",
      "required": ["jsonrpc", "id", "result"],
      "properties": {
        "jsonrpc": {"type": "string", "const": "2.0"},
        "id": {"type": "string"},
        "result": {
          "type": "object",
          "required": ["deleted"],
          "properties": {
            "deleted": {"type": "boolean"}
          }
        }
      }
    }
  },

  "examples": {
    "create_session_request": {
      "jsonrpc": "2.0",
      "id": "req-sess-001",
      "method": "create_session",
      "params": {
        "metadata": {
          "user": "researcher_001",
          "experiment": "exp_2025_001"
        }
      }
    },
    "create_session_response": {
      "jsonrpc": "2.0",
      "id": "req-sess-001",
      "result": {
        "id": "sess-123e4567-e89b-12d3-a456-426614174000",
        "created_at": "2025-10-06T12:00:00Z",
        "metadata": {
          "user": "researcher_001",
          "experiment": "exp_2025_001"
        }
      }
    },
    "get_history_request": {
      "jsonrpc": "2.0",
      "id": "req-hist-001",
      "method": "get_session_history",
      "params": {
        "session_id": "sess-123e4567",
        "limit": 50,
        "offset": 0
      }
    },
    "get_history_response": {
      "jsonrpc": "2.0",
      "id": "req-hist-001",
      "result": {
        "session_id": "sess-123e4567",
        "messages": [
          {
            "id": "msg-001",
            "role": "user",
            "content": "Can you convert this spike2 file?",
            "timestamp": "2025-10-06T12:01:00Z",
            "agent": null,
            "metadata": {}
          },
          {
            "id": "msg-002",
            "role": "assistant",
            "content": "Yes, I can convert spike2 files to NWB format.",
            "timestamp": "2025-10-06T12:01:05Z",
            "agent": "orchestrator",
            "metadata": {
              "confidence": 0.95
            }
          }
        ],
        "total": 2,
        "has_more": false
      }
    },
    "add_message_request": {
      "jsonrpc": "2.0",
      "id": "req-msg-001",
      "method": "add_message",
      "params": {
        "session_id": "sess-123e4567",
        "role": "user",
        "content": "Please proceed with the conversion",
        "metadata": {
          "input_file": "/data/experiment.spike2"
        }
      }
    },
    "add_message_response": {
      "jsonrpc": "2.0",
      "id": "req-msg-001",
      "result": {
        "message_id": "msg-003",
        "timestamp": "2025-10-06T12:02:00Z"
      }
    }
  }
}
