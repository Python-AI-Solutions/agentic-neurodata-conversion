[workspace]
name = "agentic-neurodata-conversion"
version = "0.1.0"
description = "AI-assisted neurodata conversion to NWB format using multi-agent architecture"
authors = ["Aditya Patane <aditya@example.com>"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "linux-64"]

# ============================================================================
# Runtime Dependencies - What users/production needs
# ============================================================================
[dependencies]
python = "3.13.*"
# Core web framework
fastapi = ">=0.115.0"
uvicorn = ">=0.32.0"
pydantic = ">=2.9.0"
# Reporting and templating
reportlab = ">=4.2.5"
jinja2 = ">=3.1.4"
# HTTP client
httpx = ">=0.27.2"
# Data handling
pyyaml = ">=6.0.2"
numpy = ">=2.1.3"
h5py = ">=3.12.1"

[pypi-dependencies]
# Neuroscience stack
neuroconv = ">=0.7.3"
pynwb = ">=3.0.0"
nwbinspector = ">=0.6.0"
spikeinterface = ">=0.101.0"
# AI and communication
anthropic = ">=0.39.0"
websockets = ">=13.1"
# Configuration
python-dotenv = ">=1.0.0"

[tasks]
# Development tasks
dev = "uvicorn agentic_neurodata_conversion.api.main:app --reload --host 0.0.0.0 --port 8000"

# Test tasks - Primary
test = "pytest tests -v"
test-cov = "pytest tests -v --cov=agentic_neurodata_conversion --cov-report=term-missing --cov-report=html"

# Test by scope (Tier 1)
test-unit = "pytest tests -v -m unit"
test-integration = "pytest tests -v -m integration"
test-e2e = "pytest tests -v -m e2e"

# Test by component (Tier 2)
test-agent-conversation = "pytest tests -v -m agent_conversation"
test-agent-conversion = "pytest tests -v -m agent_conversion"
test-agent-evaluation = "pytest tests -v -m agent_evaluation"
test-service = "pytest tests -v -m service"
test-model = "pytest tests -v -m model"
test-api = "pytest tests -v -m api"
test-websocket = "pytest tests -v -m websocket"

# Test by characteristics (Tier 3)
test-slow = "pytest tests -v -m slow"
test-property = "pytest tests -v -m property"
test-fast = "pytest tests -v -m 'not slow'"

# CI/CD (Tier 4)
test-smoke = "pytest tests -v -m smoke"

# Development status (Tier 5)
test-aspirational = "pytest tests -v -m aspirational"
test-wip = "pytest tests -v -m wip"
test-blocked = "pytest tests -v -m blocked"

# Code quality tasks
lint = "ruff check agentic_neurodata_conversion/ tests/ scripts/"
format = "ruff format agentic_neurodata_conversion/ tests/ scripts/"
typecheck = "mypy agentic_neurodata_conversion"
precommit = "sh -c 'pixi run lint && pixi run format && pixi run typecheck && pixi run test'"

# Utility tasks
generate-fixtures = "python tests/fixtures/generate_toy_dataset.py"
clean = "rm -rf agentic_neurodata_conversion/__pycache__ tests/__pycache__ .pytest_cache .coverage htmlcov coverage.xml"
serve = "python run_server.py"

# ============================================================================
# Development Dependencies - Testing, linting, type checking
# ============================================================================
[feature.dev.dependencies]
# Testing framework
pytest = ">=8.3.3"
pytest-cov = ">=6.0.0"
pytest-asyncio = ">=0.24.0"
pytest-timeout = ">=2.2.0"
pytest-mock = ">=3.12.0"
pytest-xdist = ">=3.5.0"
# Property-based testing
hypothesis = ">=6.0.0"
# Code quality
ruff = ">=0.14.4"
mypy = ">=1.18.2"
bandit = ">=1.7.6"
pydocstyle = ">=6.3.0"
# Type stubs
types-python-dateutil = ">=2.9.0.20251108,<3"
types-pyyaml = ">=6.0.0"
# Git hooks
pre-commit = ">=4.3.0,<5"
# Development tools
ipython = ">=8.29.0"

[feature.dev.pypi-dependencies]
# Install local package in editable mode for development
# This makes `import agentic_neurodata_conversion` work and CLI commands available
agentic-neurodata-conversion = { path = ".", editable = true }

[environments]
default = {features = ["dev"], solve-group = "default"}
